"use strict";(()=>{var e={};e.id=42,e.ids=[42],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39613:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>m,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var r={};s.r(r),s.d(r,{POST:()=>c});var n=s(49303),i=s(88716),o=s(60670),a=s(87070),u=s(19692);async function c(e){try{let t;let{event_id:s,email:r,phone:n}=await e.json();if(!s)return a.NextResponse.json({message:"Event ID is required"},{status:400});if(!r&&!n)return a.NextResponse.json({message:"Email or phone is required"},{status:400});let i=(0,u.e)(),{data:o,error:c}=await i.from("events").select("id, name, voting_start_time, voting_end_time, auth_settings").eq("id",s).single();if(c||!o){console.log("Database not available, using mock login for demo");let e=`mock-voter-${Buffer.from(r||n||"guest").toString("base64").slice(0,16)}`;return a.NextResponse.json({message:"Login successful (demo mode)",voter_id:e})}let l=o.auth_settings;if(l?.require_otp)return a.NextResponse.json({message:"OTP is required for this event"},{status:400});let p=new Date,d=new Date(o.voting_start_time),g=new Date(o.voting_end_time);if(p<d)return a.NextResponse.json({message:"B\xecnh chọn chưa bắt đầu"},{status:400});if(p>g)return a.NextResponse.json({message:"B\xecnh chọn đ\xe3 kết th\xfac"},{status:400});let m=i.from("voters").select("id").eq("event_id",s);r&&(m=m.eq("email",r)),n&&(m=m.eq("phone",n));let{data:v}=await m.single();if(v)t=v.id;else{let{data:e,error:o}=await i.from("voters").insert({event_id:s,email:r,phone:n,is_verified:!0}).select("id").single();if(o||!e)return console.error("Error creating voter:",o),a.NextResponse.json({message:"Failed to create voter"},{status:500});t=e.id}return a.NextResponse.json({message:"Login successful",voter_id:t})}catch(e){return console.error("Error in quick-login route:",e),a.NextResponse.json({message:"Internal server error"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/quick-login/route",pathname:"/api/auth/quick-login",filename:"route",bundlePath:"app/api/auth/quick-login/route"},resolvedPagePath:"/Users/tuanpham/MyLife/CRM-Pacificwide/event-voting/app/api/auth/quick-login/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:g}=l,m="/api/auth/quick-login/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},19692:(e,t,s)=>{s.d(t,{e:()=>i});var r=s(75117),n=s(71615);function i(){let e=(0,n.cookies)();return(0,r.lx)("https://xicdommyxzsschupzvsx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpY2RvbW15eHpzc2NodXB6dnN4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMTc3NzcsImV4cCI6MjA3Nzg5Mzc3N30.MAmu4KlsDw-GuE_PT6ApiBq58eH3r8xnbcuQjQ4PzME",{cookies:{get:t=>e.get(t)?.value,set(t,s,r){try{e.set({name:t,value:s,...r})}catch(e){}},remove(t,s){try{e.set({name:t,value:"",...s})}catch(e){}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,9564,5117],()=>s(39613));module.exports=r})();